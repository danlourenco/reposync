#!/bin/sh

# Exit on error
set -e

echo "ğŸ” Running pre-push checks..."
echo ""

# Change to nsync package directory
cd packages/nsync

echo "ğŸ“ Running linter..."
npm run lint --silent || {
    echo "âŒ Linting failed! Please fix the errors before pushing."
    exit 1
}
echo "âœ… Linting passed"
echo ""

echo "ğŸ§ª Running unit tests..."
# Run tests and capture output to check for actual failures vs expected stderr
if npm test -- --run --reporter=dot 2>&1 | grep -q "Tests.*passed"; then
    echo "âœ… All tests passed"
else
    echo "âŒ Tests failed! Please fix the failing tests before pushing."
    exit 1
fi
echo ""

echo "ğŸ‰ Pre-push checks passed! Ready to push."